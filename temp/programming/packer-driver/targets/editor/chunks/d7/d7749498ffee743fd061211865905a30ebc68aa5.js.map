{"version":3,"sources":["file:///E:/workspace/CocosDashBoard/3D-Jump/assets/Scripts/GameManager.ts"],"names":["_decorator","Component","Prefab","instantiate","Node","Label","CCInteger","Vec3","Button","PlayerController","ccclass","property","BlockType","GameState","GameType","GameManager","type","_road","currentBlockIndex","userOption","curGameType","NORMAL","onNormalButton","changeButtonColor","normal","normalColor","set","onLimitedTimeButton","limited","LIMIT_TIME","onEndlessButton","endless","END_LESS","number","_updateState","start","curState","GS_INIT","playerCtrl","node","on","onPlayerJumpEnd","init","failMenu","successMenu","active","startMenu","generateRoad","setInputActive","setPosition","ZERO","reset","value","GS_PLAYING","stepsLabel","string","setTimeout","GS_END","GS_FAIL","removeAllChildren","push","BT_STONE","i","roadLength","BT_NONE","Math","floor","random","linkedBlocks","j","length","spawnBlockByCount","lastPos","count","block","spawnBlockByType","addChild","setScale","cubePrfb","onStartButtonClicked","playAgain","checkResult","moveIndex","firstBlock","children","destroy","blockType"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, instantiate, Node, Label, CCInteger, Vec3, Button } from 'cc';\r\nimport { PlayerController } from \"./PlayerController\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 赛道格子类型，坑（BT_NONE）或者实路（BT_STONE）\r\nenum BlockType {\r\n    BT_NONE,\r\n    BT_STONE,\r\n};\r\n\r\nenum GameState {\r\n    GS_INIT,\r\n    GS_PLAYING,\r\n    GS_END,\r\n    GS_FAIL,\r\n};\r\n\r\nenum GameType {\r\n    NORMAL,\r\n    LIMIT_TIME,\r\n    END_LESS,\r\n}\r\n\r\n@ccclass(\"GameManager\")\r\nexport class GameManager extends Component {\r\n\r\n    // 赛道预制\r\n    @property({ type: Prefab })\r\n    public cubePrfb: Prefab | null = null;\r\n    // 赛道长度\r\n    @property({ type: CCInteger })\r\n    public roadLength: number = 50;\r\n    private _road: BlockType[] = [];\r\n    // 初始化当前格子索引\r\n    public currentBlockIndex: number = 0;\r\n\r\n    // 主界面根节点\r\n    @property({ type: Node })\r\n    public startMenu: Node | null = null;\r\n    // 失败页面根节点\r\n    @property({ type: Node })\r\n    public failMenu: Node | null = null;\r\n    // 成功页面根节点\r\n    @property({ type: Node })\r\n    public successMenu: Node | null = null;\r\n    // 关联 Player 节点身上 PlayerController 组件\r\n    @property({ type: PlayerController })\r\n    public playerCtrl: PlayerController | null = null;\r\n    // 关联步长文本组件\r\n    @property({ type: Label })\r\n    public stepsLabel: Label | null = null!;\r\n    //用户选项选择 0-普通模式 1-限时模式 2-无尽模式\r\n    private userOption: number = 0;\r\n    //正常模式button\r\n    @property({ type: Button })\r\n    public normal: Button | null = null;\r\n    //限时模式button\r\n    @property({ type: Button })\r\n    public limited: Button | null = null;\r\n    //无尽模式button\r\n    @property({ type: Button })\r\n    public endless: Button | null = null;\r\n    // 当前选择模式\r\n    public curGameType: GameType = GameType.NORMAL;\r\n\r\n    //模式修改选择\r\n    onNormalButton() {\r\n        this.changeButtonColor(this.curGameType);\r\n        this.normal.normalColor.set(255, 0, 0, 255);\r\n        this.curGameType = GameType.NORMAL;\r\n    }\r\n\r\n    onLimitedTimeButton() {\r\n        this.changeButtonColor(this.curGameType);\r\n        this.limited.normalColor.set(255, 0, 0, 255);\r\n        this.curGameType = GameType.LIMIT_TIME;\r\n    }\r\n\r\n    onEndlessButton() {\r\n        this.changeButtonColor(this.curGameType);\r\n        this.endless.normalColor.set(255, 0, 0, 255);\r\n        this.curGameType = GameType.END_LESS;\r\n    }\r\n\r\n\r\n    //修改相应按钮颜色\r\n    changeButtonColor(number: Number) {\r\n        if (number == 0) {\r\n            this.normal.normalColor.set(0, 164, 0, 255);\r\n            (this.normal as any)._updateState();\r\n        } else if (number == 1) {\r\n            this.limited.normalColor.set(0, 164, 0, 255);\r\n            (this.limited as any)._updateState();\r\n        } else if (number == 2) {\r\n            this.endless.normalColor.set(0, 164, 0, 255);\r\n            (this.endless as any)._updateState();\r\n        }\r\n    }\r\n\r\n    start() {\r\n        this.curState = GameState.GS_INIT;\r\n        this.playerCtrl?.node.on('JumpEnd', this.onPlayerJumpEnd, this);\r\n    }\r\n\r\n    init() {\r\n        debugger;\r\n        if (this.failMenu || this.successMenu) {\r\n            this.failMenu.active = false;\r\n            this.successMenu.active = false;\r\n        }\r\n        // 激活主界面\r\n        if (this.startMenu) {\r\n            this.startMenu.active = true;\r\n        }\r\n        // 生成赛道\r\n        this.generateRoad();\r\n        if (this.playerCtrl) {\r\n            // 禁止接收用户操作人物移动指令\r\n            this.playerCtrl.setInputActive(false);\r\n            // 重置人物位置\r\n            this.playerCtrl.node.setPosition(Vec3.ZERO);\r\n            // 重置已经移动的步长数据\r\n            this.playerCtrl.reset();\r\n        }\r\n    }\r\n\r\n    set curState(value: GameState) {\r\n        switch (value) {\r\n            case GameState.GS_INIT:\r\n                this.init();\r\n                break;\r\n            case GameState.GS_PLAYING:\r\n                if (this.startMenu) {\r\n                    this.startMenu.active = false;\r\n                }\r\n\r\n                if (this.stepsLabel) {\r\n                    this.stepsLabel.string = '0';   // 将步数重置为0\r\n                }\r\n                // 会出现的现象就是，游戏开始的瞬间人物已经开始移动\r\n                // 因此，这里需要做延迟处理\r\n                setTimeout(() => {\r\n                    if (this.playerCtrl) {\r\n                        this.playerCtrl.setInputActive(true);\r\n                    }\r\n                }, 0.1);\r\n                break;\r\n            case GameState.GS_END:\r\n                if (this.successMenu) {\r\n                    this.successMenu.active = true;\r\n                }\r\n                break;\r\n            case GameState.GS_FAIL:\r\n                if (this.failMenu) {\r\n                    this.failMenu.active = true;\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    generateRoad() {\r\n        // 防止游戏重新开始时，赛道还是旧的赛道\r\n        // 因此，需要移除旧赛道，清除旧赛道数据\r\n        this.node.removeAllChildren();\r\n        this._road = [];\r\n        // 确保游戏运行时，人物一定站在实路上\r\n        this._road.push(BlockType.BT_STONE);\r\n\r\n        // 确定好每一格赛道类型\r\n        for (let i = 1; i < this.roadLength - 1; i++) {\r\n            // 如果上一格赛道是坑，那么这一格一定不能为坑\r\n            if (this._road[i - 1] === BlockType.BT_NONE) {\r\n                this._road.push(BlockType.BT_STONE);\r\n            } else {\r\n                this._road.push(Math.floor(Math.random() * 2));\r\n            }\r\n        }\r\n        // 最后一格也是石头\r\n        this._road.push(BlockType.BT_STONE);\r\n\r\n        // 根据赛道类型生成赛道\r\n        let linkedBlocks = 0;\r\n        for (let j = 0; j < this._road.length; j++) {\r\n            if (this._road[j]) {\r\n                ++linkedBlocks;\r\n            }\r\n            if (this._road[j] == 0) {\r\n                if (linkedBlocks > 0) {\r\n                    this.spawnBlockByCount(j - 1, linkedBlocks);\r\n                    linkedBlocks = 0;\r\n                }\r\n            }\r\n            if (this._road.length == j + 1) {\r\n                if (linkedBlocks > 0) {\r\n                    this.spawnBlockByCount(j, linkedBlocks);\r\n                    linkedBlocks = 0;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    spawnBlockByCount(lastPos: number, count: number) {\r\n        let block: Node | null = this.spawnBlockByType(BlockType.BT_STONE);\r\n        if (block) {\r\n            this.node.addChild(block);\r\n            block?.setScale(count, 1, 1);\r\n            block?.setPosition(lastPos - (count - 1) * 0.5, -1.5, 0);\r\n        }\r\n    }\r\n    spawnBlockByType(type: BlockType) {\r\n        if (!this.cubePrfb) {\r\n            return null;\r\n        }\r\n\r\n        let block: Node | null = null;\r\n        switch (type) {\r\n            case BlockType.BT_STONE:\r\n                block = instantiate(this.cubePrfb);\r\n                break;\r\n        }\r\n\r\n        return block;\r\n    }\r\n\r\n    onStartButtonClicked() {\r\n        // 点击主界面 play 按钮，开始游戏\r\n        this.curState = GameState.GS_PLAYING;\r\n    }\r\n\r\n    playAgain() {\r\n        this.curState = GameState.GS_INIT;\r\n    }\r\n\r\n    checkResult(moveIndex: number) {\r\n        if (moveIndex < this.roadLength - 1) {\r\n            // 跳到了坑上\r\n            if (this._road[moveIndex] == BlockType.BT_NONE) {\r\n                this.curState = GameState.GS_FAIL;\r\n                // 禁止接收用户操作人物移动指令\r\n                this.playerCtrl.setInputActive(false);\r\n            }\r\n        } else {\r\n            switch (this.curGameType) {\r\n                case GameType.NORMAL:\r\n                    // 处理普通模式的逻辑\r\n                    {\r\n                        // 跳过了最大长度\r\n                        this.curState = GameState.GS_END;\r\n                        // 禁止接收用户操作人物移动指令\r\n                        this.playerCtrl.setInputActive(false);\r\n                    }\r\n                    break;\r\n                case GameType.LIMIT_TIME:\r\n                    // 处理限时模式的逻辑\r\n                    break;\r\n                case GameType.END_LESS:\r\n                    // 处理无尽模式的逻辑\r\n                    break;\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    onPlayerJumpEnd(moveIndex: number) {\r\n        if (this.stepsLabel) {\r\n            // 因为在最后一步可能出现步伐大的跳跃，但是此时无论跳跃是步伐大还是步伐小都不应该多增加分数\r\n            this.stepsLabel.string = '' + (moveIndex >= this.roadLength ? this.roadLength : moveIndex);\r\n        }\r\n        // 检查当前下落道路的类型，获取结果\r\n        this.checkResult(moveIndex);\r\n\r\n        // 普通模式退出\r\n        if (this.curGameType === GameType.NORMAL){\r\n            return;\r\n        }\r\n\r\n        // 非普通模式下，当移动到当前格子索引大于25时\r\n        if (moveIndex >= 25) {\r\n            // 更新当前格子索引\r\n            this.currentBlockIndex++;\r\n            // 删除第一个格子\r\n            const firstBlock = this.node.children[0];\r\n            if (firstBlock) {\r\n                firstBlock.destroy();\r\n            }\r\n\r\n            // 添加新格子\r\n            let blockType: number; // 随机生成块类型，0 表示坑，1 表示石头\r\n            if (this._road[this._road.length - 1] === BlockType.BT_NONE) {\r\n                blockType = BlockType.BT_STONE;\r\n            } else {\r\n                blockType = Math.floor(Math.random() * 2);\r\n            }\r\n            this._road.push(blockType);\r\n            const block = this.spawnBlockByType(blockType);\r\n            if (block) {\r\n                this.node.addChild(block);\r\n                block.setPosition(this.roadLength + this.currentBlockIndex, -1.5, 0);\r\n            }\r\n        }\r\n    }\r\n}"]}